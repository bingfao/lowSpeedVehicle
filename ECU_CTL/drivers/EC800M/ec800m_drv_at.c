/*
 * ****************************************************************************
 * ******** Includes                                                   ********
 * ****************************************************************************
 */
#include "ec800m_drv_at.h"

#include "at_com.h"
#include "cmsis_os.h"
#include "usart.h"
/*
 * ****************************************************************************
 * ******** Private Types                                              ********
 * ****************************************************************************
 */

/*
 * ****************************************************************************
 * ******** Private constants                                          ********
 * ****************************************************************************
 */

/*
 * ****************************************************************************
 * ******** Private macro                                              ********
 * ****************************************************************************
 */

/*
 * ****************************************************************************
 * ******** Private global variables                                   ********
 * ****************************************************************************
 */
AT_COM_t g_ec800m_at_com;
UART_HandleTypeDef *g_ec800m_uart_handle = &huart2;
char g_ec800m_tx_buf[EC800M_DRV_TX_BUF_SIZE];
char g_ec800m_rx_buf[EC800M_DRV_RX_BUF_SIZE];

/*
 * ****************************************************************************
 * ******** Private functions prototypes                               ********
 * ****************************************************************************
 */
static int32_t ec800m_drv_send(char *p_buf, uint32_t len);
static int32_t ec800m_delay_ms(uint32_t ms);

/*
 * ****************************************************************************
 * ******** Extern function Definition                                 ********
 * ****************************************************************************
 */
int32_t ec800m_drv_init(void)
{
    at_com_init(&g_ec800m_at_com, g_ec800m_tx_buf, EC800M_DRV_TX_BUF_SIZE, g_ec800m_rx_buf, EC800M_DRV_RX_BUF_SIZE);
    at_com_set_send_func(&g_ec800m_at_com, ec800m_drv_send);
    at_com_set_delay_func(&g_ec800m_at_com, ec800m_delay_ms);

    return 0;
}

/*
 * ****************************************************************************
 * ******** Private function Definition                                ********
 * ****************************************************************************
 */
static int32_t ec800m_drv_send(char *p_buf, uint32_t len)
{
    if (HAL_UART_Transmit_IT(g_ec800m_uart_handle, (uint8_t *)p_buf, len)) {
        return USER_ERROR_SEND;
    }

    return 0;
}

static int32_t ec800m_delay_ms(uint32_t ms)
{
    osDelay(ms);
    return 0;
}

/*
 * ****************************************************************************
 * End File
 * ****************************************************************************
 */
